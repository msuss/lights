Todo: 
 - Break up code into modules
 - Add some sort of general way of chaining light modes
